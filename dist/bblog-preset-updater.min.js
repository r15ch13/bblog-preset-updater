/**
* BBLog Plugin        - tested with Version 4.9.0
* Battlelog Extension - tested with Version 231
*
* @author Richard Kuhnt (r15ch13)
* @link https://github.com/r15ch13/bblog-preset-updater
* @license MIT License (http://r15ch13.mit-license.org/)
* @version 1.2.0
*/
BBLog.handle("add.plugin",{id:"preset-updater",name:"Preset Updater",version:"1.2.0",css:".quick-update-preset .icon-floppy-disk{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAoCAMAAADJ7yrpAAAAdVBMVEX///////8AAAD///8AAAD///8AAAAAAAAAAAD///////8AAAD///8AAAAAAAD///8AAAAAAAD///+QkJAAAAD///8AAAD///8AAAD///8AAAAAAAAAAAD///8AAAAAAAD///////////////////8AAAD///+RiMV1AAAAJ3RSTlNoKChqZCwsAGhkPDxAQGp8fB0dBU4hIXa1FRV2W0xrLlO8rlxbcHAw0HNXAAAAwklEQVQoz33QyRKCMBBF0dYACQ5JCIizOP//J5p0dckrRO7iLc6mq5r0SKRnilKOuO12n1BpruRV1+D2EQnx9gj1e4j3Z2ASVMS5GhCaQFVCJFhqqMcwkwJgvpJyxIWEuMmlDeCZpDMgNIFqiIqf7AhyKh377R8W1qS84Y7HQ0KruYzXNpU/RDSIu1NVv0Ywwhet4XwNCE3gJYOMYKahHqu5VAF2a6lDXEoFYFtILWBjpAYQmsDLEG3EufUG8raNONIH04YXzwPcXaIAAAAASUVORK5CYII=) no-repeat;-webkit-transition:opacity .2s ease;-webkit-transition-delay:0s;-moz-transition:opacity .2s ease 0s;-o-transition:opacity .2s ease 0s;transition:opacity .2s ease 0s;content:'';width:20px;height:20px;display:block;margin:7px}.quick-apply-preset{width:168px;float:left}.quick-update-preset{height:34px;width:34px}#loadout .popover ul li .quick-update-preset{padding:0}#popup-preset-updater{height:auto;width:30%;margin-left:30%}#popup-preset-updater a[data-bind-action=cancel]{margin-left:18px}#popup-preset-updater input{line-height:24px;width:95%}#popup-preset-updater.error input{border:1px solid #af0000}#popup-preset-updater .error-message{display:none;padding:6px 0 0;font-size:12px;font-weight:700;color:#c30000}#popup-preset-updater.error .error-message{display:block;padding:6px 0 0}",debug:!1,translations:{en:{"option.enabled":"Preset Updater enabled","confirm.placeholder":"Enter a name for your preset","confirm.title":"Update preset","confirm.error":"You must specify a name for the preset to update it","button.update":"Update","button.cancel":"Cancel","error.unexpected":"Something went wrong! Please contact the developer."},de:{"option.enabled":"Preset Updater aktiviert","confirm.placeholder":"Gib einen Namen für deine Voreinstellung ein","confirm.title":"Voreinstellung aktualisieren","confirm.error":"Du musst einen Namen für die Voreinstellung festlegen, um sie aktualisieren zu können","button.update":"Aktualisieren","button.cancel":"Abbrechen","error.unexpected":"Das ist etwas schief gelaufen! Bitte kontaktiere den Entwickler."}},configFlags:[["option.enabled",1]],model:{},init:function(a){if("bf4"==BBLog.cache("mode")&&$("#loadout-flipper").length&&a.storage("option.enabled")){if(a.log("loaded (init)"),a.model=window.BL.backbone.model_instances.loadoutModel,a.addPresetUpdateButtons(a),"%CSS%"!=a.css&&""!=a.css){a.log("embedded style-tag to header");var b=$('<style type="text/css"></style>');b.html(a.css),$("head").append(b)}else{a.log("embedded external stylesheet to header");var c=document.currentScript.src.substr(0,document.currentScript.src.length-2)+"css";$("head").append($('<link rel="stylesheet" href="'+c+'" />'))}$("#content").on("click","#loadout-overview .quick-update-preset",function(b){b.preventDefault(),a.showDialog(a,$(this).prev())}),$("#dialog-container").on("click","#popup-"+a.id+" a[data-bind-action=cancel]",function(b){b.preventDefault(),a.clearCache(a),BBLog.closeAllPopups()}),$("#dialog-container").on("click","#popup-"+a.id+" a[data-bind-action=ok]",function(b){b.preventDefault(),a.cache("name",a.getNewPresetName(a)),a.validatePreset(a)&&a.updatePreset(a)})}},domchange:function(a){"bf4"==BBLog.cache("mode")&&$("#loadout-flipper").length&&a.storage("option.enabled")&&(a.log("loaded (domchange)"),a.addPresetUpdateButtons(),a.model=window.BL.backbone.model_instances.loadoutModel)},clearCache:function(a){a.cache("id",null),a.cache("key",null),a.cache("type",null),a.cache("name",null)},addPresetUpdateButtons:function(a){var b=$("#loadout-overview").find(".quick-apply-preset");b.each(function(a,b){if(0==$(b).next(".quick-update-preset").length){var c='<a class="quick-update-preset" href="#update-preset">';c+='<i class="icon-floppy-disk"></i>',c+="</a>",$(b).after(c)}})},showDialog:function(a,b){if(b){a.cache("id",b.attr("data-id")),a.cache("key",b.attr("data-key")),a.cache("type",b.attr("data-type"));var c=b.find("span").html();a.cache("name",c);var d='<p><input maxlength="240" type="text" name="preset-name" value="'+Surface.valOut(c)+'" placeholder="'+a.t("confirm.placeholder")+'"></p><p class="error-message">'+a.t("confirm.error")+"</p>",e='<div class="btn-container"><a class="btn btn-small btn-primary href="#" data-bind-action="ok">'+a.t("button.update")+'</a><a class="btn btn-small" href="#" data-bind-action="cancel">'+a.t("button.cancel")+"</a></div>";BBLog.popup(a.id,a.t("confirm.title"),d,e),$(window).off("resize.bblog-popup"),$("#popup-"+a.id+" .dialog-body").height("auto")}},getNewPresetName:function(a){return $("#popup-"+a.id).find("input[name=preset-name]").val().trim()},validatePreset:function(a){return a.cache("name")?a.cache("id")&&a.cache("key")&&a.cache("type")?!0:($("#popup-"+a.id).addClass("error"),$("#popup-"+a.id).find(".error-message").html(a.t("error.unexpected")),!1):($("#popup-"+a.id).addClass("error"),!1)},updatePreset:function(a){var b=a.cache("key");b&&(a.model.listenToOnce(a.model,"presetDeleted",_.bind(a.onPresetDeleted,a)),a.model.deletePreset(b))},onPresetDeleted:function(){var a=this,b=a.cache("id"),c=a.cache("type"),d=a.cache("name");b&&c&&d&&(a.model.listenToOnce(a.model,"presetSaved",_.bind(a.onPresetSaved,a)),a.model.savePreset(d,c,b))},onPresetSaved:function(){var a=this;a.clearCache(a),BBLog.closeAllPopups()},log:function(){var a=this;if(a.debug){var b=Array.prototype.slice.call(arguments);window.console.log(a.name+" (v"+a.version+"): "+b.join(", "))}}});